# ComfyUI 工作流管理器

## 简介

ComfyUI工作流管理器是一个功能强大的扩展，帮助您高效地保存、加载、管理和执行ComfyUI工作流。它不仅提供了方便的工作流管理界面，还支持参数化执行工作流，让您能够复用工作流并通过API快速调用。

## 主要功能

- **工作流保存与管理**
  - 保存当前工作流到服务器，支持指定ID或自动生成
  - 管理已保存的工作流列表，支持搜索和筛选
  - 加载或删除已保存的工作流

- **参数化执行**
  - 支持输入节点参数替换功能，通过API执行工作流时自动替换参数
  - 智能参数类型转换，自动将输入参数转换为正确的数据类型
  - 支持通过输出节点名称匹配参数，实现灵活的参数传递

- **节点参数管理**
  - 自动将输出参数(outputs)写入到输入参数(inputs)中
  - 支持各种类型节点的参数映射，包括自定义节点
  - 工作流保存时自动增强widgets信息，确保API执行时参数能正确映射

- **API接口**
  - 提供完整的REST API用于编程访问
  - 支持通过API保存、获取、执行工作流
  - 每次执行生成唯一的客户端ID，确保多线程安全执行

## 安装方法

1. 将此仓库克隆到ComfyUI的`custom_nodes`目录：

```bash
cd ComfyUI/custom_nodes
git clone https://github.com/yourusername/ComfyUI-workflow-manager.git
```

2. 重启ComfyUI服务器，扩展会自动加载。

## 使用指南

### 基本操作

安装完成后，您将在ComfyUI顶部菜单栏看到两个新图标按钮：

- 📁 保存工作流：保存当前工作流到服务器
- 👁️ 查询工作流：打开工作流列表管理界面

### 工作流保存

1. 设计您的工作流，完成后点击保存按钮
2. 输入工作流名称（必填）和描述（可选）
3. 可选：指定工作流ID，不填则自动生成
4. 点击"保存"按钮确认

### 工作流管理

1. 点击查询按钮打开工作流列表
2. 使用搜索框筛选工作流
3. 对每个工作流，可以进行：
   - 加载：将工作流加载到当前编辑区
   - 删除：从服务器移除工作流
   - 执行：打开参数执行对话框

### 带参数执行

1. 在工作流列表中点击工作流的"执行"按钮
2. 在参数框中输入JSON格式的参数
3. 参数名称应与工作流中输入节点的输出参数名称匹配
4. 点击"执行"，工作流将以提供的参数在服务器端执行

### 创建可参数化工作流

要创建可接受参数的工作流，需要使用以`iyunya_in_`开头的输入节点：

1. 在工作流中添加输入节点(以`iyunya_in_`开头)
2. 设置输入节点的输出参数名称，这将成为API参数的键名
3. 连接输入节点到工作流的其他部分
4. 保存工作流
5. 执行时，提供与输出参数名称匹配的参数

### 通过API执行

您可以通过HTTP API以编程方式执行工作流：

```
POST /api/workflow/execute/{workflow_id}
Content-Type: application/json

{
  "params": {
    "prompt": "一只可爱的猫",
    "seed": 42,
    "width": 512,
    "height": 512
  }
}
```

参数中的键名应与工作流输入节点的输出参数名称匹配。

## 技术实现

- **前端**：基于ComfyUI的JavaScript API，提供直观的用户界面
- **后端**：Python实现的REST API，支持工作流存储和执行
- **数据存储**：工作流以JSON格式存储在`workflow_saves`目录中
- **参数处理**：前端格式到API格式的智能转换，输出参数自动映射到输入参数

## 高级功能

- **工作流格式转换**：自动将前端格式转换为API格式，支持复杂的节点结构
- **类型智能转换**：根据参数类型自动转换输入值，支持数字、布尔值、字符串等
- **随机客户端ID**：每次执行生成随机ID，支持并发执行同一工作流

## 贡献

欢迎提交问题或改进建议！欢迎Pull Request。

## 许可

本项目采用MIT许可证。 